<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pipeline Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .agent { display: inline-block; margin: 10px; padding: 15px; border-radius: 5px; min-width: 200px; }
        .online { background: #d4edda; border: 1px solid #c3e6cb; }
        .offline { background: #f8d7da; border: 1px solid #f5c6cb; }
        .status-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .green { background-color: #28a745; }
        .red { background-color: #dc3545; }
        .yellow { background-color: #ffc107; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; height: 300px; overflow-y: scroll; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AI Pipeline Dashboard</h1>
        
        <div class="card">
            <h2>–°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–æ–≤</h2>
            <div id="agents-status">
                <div class="agent online">
                    <span class="status-dot green"></span>
                    <strong>üéõÔ∏è Dashka</strong><br>
                    Telegram Bot: –ê–∫—Ç–∏–≤–µ–Ω<br>
                    –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.2s
                </div>
                <div class="agent online">
                    <span class="status-dot green"></span>
                    <strong>üß† Claude</strong><br>
                    API: –ü–æ–¥–∫–ª—é—á–µ–Ω<br>
                    –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.3s
                </div>
                <div class="agent online">
                    <span class="status-dot green"></span>
                    <strong>üíª DeepSeek</strong><br>
                    API: –ü–æ–¥–∫–ª—é—á–µ–Ω<br>
                    –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.2s
                </div>
            </div>
        </div>

        <div class="card">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
            <button onclick="checkStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <button onclick="testDelegation()">üß™ –¢–µ—Å—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="connectWebSocket()">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å WebSocket</button>
        </div>

        <div class="card">
            <h2>Live –ª–æ–≥</h2>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let ws = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function checkStatus() {
            try {
                const response = await fetch('/api/agents/status');
                const data = await response.json();
                log('‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ' + JSON.stringify(data, null, 2));
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        async function testDelegation() {
            try {
                const response = await fetch('/api/test/delegation', { method: 'POST' });
                const data = await response.json();
                log('üß™ –¢–µ—Å—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: ' + JSON.stringify(data, null, 2));
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + error.message);
            }
        }
        
        function connectWebSocket() {
            if (ws) {
                ws.close();
            }
            
            ws = new WebSocket('ws://localhost:8000/ws/dashboard');
            
            ws.onopen = function() {
                log('üîå WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                log('üì® WebSocket: ' + JSON.stringify(data, null, 2));
            };
            
            ws.onclose = function() {
                log('üîå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
            };
            
            ws.onerror = function(error) {
                log('‚ùå WebSocket –æ—à–∏–±–∫–∞: ' + error);
            };
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ Dashboard –∑–∞–≥—Ä—É–∂–µ–Ω');
            checkStatus();
        };
    </script>
</body>
</html>
